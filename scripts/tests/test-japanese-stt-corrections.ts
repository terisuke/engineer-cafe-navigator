#!/usr/bin/env tsx

/**
 * æ—¥æœ¬èªSTTèª¤èªè­˜ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ
 */

import { config } from 'dotenv';
config({ path: '.env.local' });

import { STTCorrection } from '@/lib/stt-correction';

console.log('ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªSTTèª¤èªè­˜ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ');
console.log('================================================================================');

interface TestCase {
  input: string;
  expected: string;
  category: string;
}

const testCases: TestCase[] = [
  // ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®èª¤èªè­˜
  { category: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å£ã®å–¶æ¥­æ™‚é–“ã¯ï¼Ÿ', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®å–¶æ¥­æ™‚é–“ã¯ï¼Ÿ' },
  { category: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢åŠ å·¥ã«ã¤ã„ã¦æ•™ãˆã¦', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã«ã¤ã„ã¦æ•™ãˆã¦ã€‚' },
  { category: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢èª²ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã¯ã©ã“ã§ã™ã‹ï¼Ÿ' },
  { category: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ™ã®æ–™é‡‘', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®æ–™é‡‘ã€‚' },
  { category: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§', input: 'engineer wallã¯ã‚ã‚Šã¾ã™ã‹', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã¯ã‚ã‚Šã¾ã™ã‹ã€‚' },
  
  // ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã®èª¤èªè­˜ï¼ˆæ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
  { category: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§', input: 'ã‚µã‚¤ã®ã‚«ãƒ•ã‚§ã®å ´æ‰€', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã®å ´æ‰€ã€‚' },
  { category: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§', input: 'ã•ã„ãªã‚«ãƒ•ã‚§ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€‚' },
  { category: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§', input: 'æ‰ç´ã‚«ãƒ•ã‚§ã¯ã„ã¤ã‹ã‚‰ï¼Ÿ', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã¯ã„ã¤ã‹ã‚‰ï¼Ÿ' },
  { category: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§', input: 'è²¡é‡ã‚«ãƒ•ã‚§ã®å–¶æ¥­æ™‚é–“', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã®å–¶æ¥­æ™‚é–“ã€‚' },
  { category: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§', input: 'æ‰è„³ã‚«ãƒ•ã‚§ã«ã¤ã„ã¦', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã«ã¤ã„ã¦ã€‚' },
  
  // ã‚«ãƒ•ã‚§è‡ªä½“ã®èª¤èªè­˜
  { category: 'ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ˜ã®å ´æ‰€', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®å ´æ‰€ã€‚' },
  { category: 'ã‚«ãƒ•ã‚§', input: 'ã‚µã‚¤ãƒã‚«ãƒšã¯ã©ã“ï¼Ÿ', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã¯ã©ã“ï¼Ÿ' },
  { category: 'ã‚«ãƒ•ã‚§', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã¸ã®æ–™é‡‘', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®æ–™é‡‘ã€‚' },
  { category: 'ã‚«ãƒ•ã‚§', input: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚¡ã«ã¤ã„ã¦', expected: 'ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã«ã¤ã„ã¦ã€‚' },
  
  // ä¼šè­°å®¤ã®èª¤èªè­˜
  { category: 'ä¼šè­°å®¤', input: 'ä¼šè­°è³ªã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ', expected: 'ä¼šè­°å®¤ã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ' },
  { category: 'ä¼šè­°å®¤', input: 'åœ°ä¸‹ã®é–‹è­°å®¤ã«ã¤ã„ã¦', expected: 'åœ°ä¸‹ã®ä¼šè­°å®¤ã«ã¤ã„ã¦ã€‚' },
  { category: 'ä¼šè­°å®¤', input: 'éšè­°å®¤ã®äºˆç´„æ–¹æ³•', expected: 'ä¼šè­°å®¤ã®äºˆç´„æ–¹æ³•ã€‚' },
  { category: 'ä¼šè­°å®¤', input: 'ã‹ã„ãã—ã¤ã®æ–™é‡‘', expected: 'ä¼šè­°å®¤ã®æ–™é‡‘ã€‚' },
  
  // åœ°ä¸‹æ–½è¨­ã®èª¤èªè­˜
  { category: 'åœ°ä¸‹æ–½è¨­', input: 'åé›†ã‚¹ãƒšãƒ¼ã‚¹ã¯ã©ã“ï¼Ÿ', expected: 'é›†ä¸­ã‚¹ãƒšãƒ¼ã‚¹ã¯ã©ã“ï¼Ÿ' },
  { category: 'åœ°ä¸‹æ–½è¨­', input: 'çµ‚æ—¥ã‚¹ãƒšãƒ¼ã‚¹ã®åˆ©ç”¨æ™‚é–“', expected: 'é›†ä¸­ã‚¹ãƒšãƒ¼ã‚¹ã®åˆ©ç”¨æ™‚é–“ã€‚' },
  { category: 'åœ°ä¸‹æ–½è¨­', input: 'ã‚¢ãƒ³ãƒ€ãƒ¼ã™ãºãƒ¼ã™ã«ã¤ã„ã¦', expected: 'ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã«ã¤ã„ã¦ã€‚' },
  { category: 'åœ°ä¸‹æ–½è¨­', input: 'ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚ºã‚¹ãƒšãƒ¼ã‚¹ã®è¨­å‚™', expected: 'Makersã‚¹ãƒšãƒ¼ã‚¹ã®è¨­å‚™ã€‚' },
  { category: 'åœ°ä¸‹æ–½è¨­', input: 'under spaceã¯ã‚ã‚Šã¾ã™ã‹', expected: 'ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ãƒšãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã™ã‹ã€‚' },
  
  // è¤‡åˆçš„ãªèª¤èªè­˜
  { category: 'è¤‡åˆ', input: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å£ã¨æ‰èƒ½ã‚«ãƒ˜ã®é•ã„', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã¨ã‚µã‚¤ãƒã‚«ãƒ•ã‚§ã®é•ã„ã€‚' },
  { category: 'è¤‡åˆ', input: 'åœ°ä¸‹ã®ä¼šè­°è³ªã¨åé›†ã‚¹ãƒšãƒ¼ã‚¹', expected: 'åœ°ä¸‹ã®ä¼šè­°å®¤ã¨é›†ä¸­ã‚¹ãƒšãƒ¼ã‚¹ã€‚' },
  { category: 'è¤‡åˆ', input: 'engineer wallã®éšä¸‹ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚ºã‚¹ãƒšãƒ¼ã‚¹', expected: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒ•ã‚§ã®åœ°ä¸‹ã®Makersã‚¹ãƒšãƒ¼ã‚¹ã€‚' }
];

let totalPassed = 0;
let totalFailed = 0;

// ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ãƒ†ã‚¹ãƒˆ
const categories = [...new Set(testCases.map(tc => tc.category))];

for (const category of categories) {
  console.log(`\nğŸ“ ${category}ã®ãƒ†ã‚¹ãƒˆ`);
  console.log('----------------------------------------');
  
  const categoryTests = testCases.filter(tc => tc.category === category);
  let categoryPassed = 0;
  
  for (const test of categoryTests) {
    const corrected = STTCorrection.correct(test.input);
    const passed = corrected === test.expected;
    
    if (passed) {
      categoryPassed++;
      totalPassed++;
      console.log(`âœ… "${test.input}"`);
      console.log(`   â†’ "${corrected}"`);
    } else {
      totalFailed++;
      console.log(`âŒ "${test.input}"`);
      console.log(`   â†’ å®Ÿéš›: "${corrected}"`);
      console.log(`   â†’ æœŸå¾…: "${test.expected}"`);
    }
  }
  
  console.log(`\nå°è¨ˆ: ${categoryPassed}/${categoryTests.length} (${Math.round(categoryPassed / categoryTests.length * 100)}%)`);
}

// ç·åˆçµæœ
console.log('\n================================================================================');
console.log('ğŸ“Š ç·åˆçµæœ');
console.log('================================================================================');
console.log(`âœ… æˆåŠŸ: ${totalPassed}ä»¶`);
console.log(`âŒ å¤±æ•—: ${totalFailed}ä»¶`);
console.log(`ğŸ“ˆ æˆåŠŸç‡: ${Math.round(totalPassed / testCases.length * 100)}%`);

if (totalFailed === 0) {
  console.log('\nğŸ‰ å…¨ã¦ã®æ—¥æœ¬èªSTTèª¤èªè­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼');
} else {
  console.log('\nâš ï¸  ä¸€éƒ¨ã®èª¤èªè­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæœªå¯¾å¿œã§ã™ã€‚');
}

// å®Ÿéš›ã®ä¼šè©±ä¾‹ã§ã®ãƒ†ã‚¹ãƒˆ
console.log('\n\nğŸ’¬ å®Ÿéš›ã®ä¼šè©±ä¾‹ã§ã®ãƒ†ã‚¹ãƒˆ');
console.log('================================================================================');

const realConversations = [
  'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å£ã®åœ°ä¸‹ã«ä¼šè­°è³ªã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
  'æ‰èƒ½ã‚«ãƒ˜ã¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚«ãƒšã®é•ã„ã‚’æ•™ãˆã¦',
  'ã‚µã‚¤ã®ã‚«ãƒ•ã‚§ã®åé›†ã‚¹ãƒšãƒ¼ã‚¹ã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ',
  'ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚ºã‚¹ãƒšãƒ¼ã‚¹ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã™ãºãƒ¼ã™ã®å ´æ‰€'
];

console.log('å®Ÿéš›ã«èµ·ã“ã‚Šã†ã‚‹ä¼šè©±ã§ã®è£œæ­£çµæœ:');
for (const conv of realConversations) {
  const corrected = STTCorrection.correct(conv);
  console.log(`\nå…¥åŠ›: "${conv}"`);
  console.log(`è£œæ­£: "${corrected}"`);
}